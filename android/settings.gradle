include ':app'

final def localPropertiesFile = new File(
  rootProject.projectDir,
  'local.properties'
)
final def properties = new Properties()

assert localPropertiesFile.exists()
localPropertiesFile.withReader('UTF-8') {
  final reader -> properties.load(reader)
}

final def flutterSdkPath = properties.getProperty('flutter.sdk')
assert flutterSdkPath != null, 'flutter.sdk not set in local.properties'
apply from:
  "$flutterSdkPath/packages/flutter_tools/gradle/app_plugin_loader.gradle"

final def flutterProjectRoot = rootProject.projectDir.parentFile.toPath()

final def plugins = new Properties()
final def pluginsFile = new File(
  flutterProjectRoot.toFile(),
  '.flutter-plugins'
)
if (pluginsFile.exists()) {
  pluginsFile.withInputStream { final stream -> plugins.load(stream) }
}

plugins.each { name, path ->
  final def pluginDirectory = flutterProjectRoot
    .resolve(path)
    .resolve('android')
    .toFile()
  include ":$name"
  project(":$name").projectDir = pluginDirectory
}

